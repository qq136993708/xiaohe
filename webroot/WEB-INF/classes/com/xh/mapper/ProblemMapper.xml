<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- namespace用于绑定接口对象 -->
<mapper namespace="com.xh.mapper.ProblemMapper">




	<resultMap type="com.xh.pojo.Problem" id="problemResultMap1">
		<result column="problemType" property="problemType" jdbcType="VARCHAR" />
		<result column="description" property="description" jdbcType="VARCHAR" />
		<result column="details" property="details" jdbcType="VARCHAR" />
		<result column="other" property="other" jdbcType="VARCHAR" />
		<result column="belongProbject" property="belongProbject"
			jdbcType="VARCHAR" />
		<result column="submitDate" property="submitDate" jdbcType="VARCHAR" />
		<association column="userid"  property="user"   javaType="com.xh.pojo.User">
			<result column="username" property="username" jdbcType="VARCHAR" />
			<result column="phoneNumber" property="phoneNumber" jdbcType="VARCHAR" />
			<result column="otherContact" property="otherContact"
				jdbcType="VARCHAR" />

		</association>
		<association  column="mechanismid" property="mechanism" javaType="com.xh.pojo.Mechanism">
			<id column="id" property="id"/>
			<result column="name" property="name" jdbcType="VARCHAR" />
			<result column="province" property="ch_province" jdbcType="VARCHAR" />
			<result column="city" property="ch_city" jdbcType="VARCHAR" />
			<result column="area" property="ch_area" jdbcType="VARCHAR" />
			<result column="fullAddress" property="fullAddress" jdbcType="VARCHAR" />
			<result column="mechanismType" property="mechanismType"
				jdbcType="VARCHAR" />
			<result column="features" property="features" jdbcType="VARCHAR" />

		</association>
	</resultMap>
	<insert id="insertProblem">
		insert into t_problem
		<trim prefix="(" suffix=")" suffixOverrides=",">
			<if test="user.id != null">
				userid,
			</if>
			<if test="problemType != null">
				problemType,
			</if>
			<if test="description != null">
				description,
			</if>
			<if test="details != null">
				details,
			</if>
			<if test="belongProbject != null">
				belongProbject,
			</if>
			<if test="mechanism.id != null">
				mechanismid,
			</if>
			<if test="submitDate != null">
				submitDate,
			</if>
			<if test="other != null">
				other,
			</if>
		</trim>
		<trim prefix="values (" suffix=")" suffixOverrides=",">
			<if test="user.id != null">
				#{user.id},
			</if>
			<if test="problemType != null">
				#{problemType},
			</if>
			<if test="description != null">
				#{description},
			</if>
			<if test="details != null">
				#{details},
			</if>
			<if test="belongProbject != null">
				#{belongProbject},
			</if>
			<if test="mechanism.id != null">
				#{ mechanism.id},
			</if>
			<if test="submitDate != null">
				#{submitDate},
			</if>
			<if test="other != null">
				#{other},
			</if>
		</trim>
	</insert>

	<select id="getProblem" resultMap="com.xh.mapper.ProblemMapper.problemResultMap1">
		SELECT a.belongProbject,a.description,a.details,a.other,a.problemType,a.submitDate,a.other,
		b.otherContact,b.phoneNumber,b.username,
		c.area,c.city,c.features,c.mechanismType,c.name,c.province,c.fullAddress
	 FROM t_problem a
		INNER JOIN t_user b ON a.userid=b.id
		INNER JOIN t_mechanism c ON a.mechanismid=c.id
	</select>

	<!-- 保存用户 -->
	<insert id="saveProblem" parameterType="com.xh.pojo.Problem">
		insert into t_problem
		(userid,problemType,description,details,
		belongProbject,mechanismId,submitDate)
		values
		(#{userid},#{problemType},#{description},#{details},
		#{belongProbject},#{mechanismId},#{submitDate})
	</insert>


</mapper>